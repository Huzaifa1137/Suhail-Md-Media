const { spawnSync } = require('child_process')
const { existsSync, writeFileSync } = require('fs')

const SESSION_ID = 'SUHAIL_17_36_09_30_ewogICJjcmVkcy5qc29uIjogIntcbiAgXCJub2lzZUtleVwiOiB7XG4gICAgXCJwcml2YXRlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcIkJ1ZmZlclwiLFxuICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgMjQ4LFxuICAgICAgICAyMTksXG4gICAgICAgIDExNSxcbiAgICAgICAgMzksXG4gICAgICAgIDExMSxcbiAgICAgICAgNzUsXG4gICAgICAgIDIyNCxcbiAgICAgICAgNDgsXG4gICAgICAgIDQ5LFxuICAgICAgICA0NyxcbiAgICAgICAgNTAsXG4gICAgICAgIDI5LFxuICAgICAgICAxNDYsXG4gICAgICAgIDE2MCxcbiAgICAgICAgMjEwLFxuICAgICAgICAxNzEsXG4gICAgICAgIDEyMCxcbiAgICAgICAgMTA4LFxuICAgICAgICAxNDksXG4gICAgICAgIDE0NSxcbiAgICAgICAgNjUsXG4gICAgICAgIDIzLFxuICAgICAgICAxNzAsXG4gICAgICAgIDIzMixcbiAgICAgICAgMTk5LFxuICAgICAgICAxNjEsXG4gICAgICAgIDMyLFxuICAgICAgICAxNDEsXG4gICAgICAgIDE1NyxcbiAgICAgICAgMzksXG4gICAgICAgIDEyMyxcbiAgICAgICAgMTEzXG4gICAgICBdXG4gICAgfSxcbiAgICBcInB1YmxpY1wiOiB7XG4gICAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICAgIFwiZGF0YVwiOiBbXG4gICAgICAgIDE4NixcbiAgICAgICAgNzAsXG4gICAgICAgIDczLFxuICAgICAgICAyMDYsXG4gICAgICAgIDkwLFxuICAgICAgICAxMTAsXG4gICAgICAgIDMzLFxuICAgICAgICAxNDMsXG4gICAgICAgIDI4LFxuICAgICAgICAxMDIsXG4gICAgICAgIDE0MCxcbiAgICAgICAgMjMyLFxuICAgICAgICAxMjgsXG4gICAgICAgIDUyLFxuICAgICAgICAyMTksXG4gICAgICAgIDE5NixcbiAgICAgICAgMTMwLFxuICAgICAgICAxNzAsXG4gICAgICAgIDk1LFxuICAgICAgICA4MCxcbiAgICAgICAgNjUsXG4gICAgICAgIDIxNyxcbiAgICAgICAgMzQsXG4gICAgICAgIDkyLFxuICAgICAgICA0MyxcbiAgICAgICAgMTgxLFxuICAgICAgICAxNTMsXG4gICAgICAgIDIwOSxcbiAgICAgICAgMzQsXG4gICAgICAgIDE0OCxcbiAgICAgICAgMjM1LFxuICAgICAgICAzMFxuICAgICAgXVxuICAgIH1cbiAgfSxcbiAgXCJwYWlyaW5nRXBoZW1lcmFsS2V5UGFpclwiOiB7XG4gICAgXCJwcml2YXRlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcIkJ1ZmZlclwiLFxuICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgOTYsXG4gICAgICAgIDUwLFxuICAgICAgICA1NCxcbiAgICAgICAgMTM3LFxuICAgICAgICAxMDcsXG4gICAgICAgIDE0MyxcbiAgICAgICAgMTEwLFxuICAgICAgICAyMzksXG4gICAgICAgIDUxLFxuICAgICAgICAxNTEsXG4gICAgICAgIDU4LFxuICAgICAgICAyMDgsXG4gICAgICAgIDI1MyxcbiAgICAgICAgMjA0LFxuICAgICAgICA5NixcbiAgICAgICAgODgsXG4gICAgICAgIDIxOCxcbiAgICAgICAgMTQzLFxuICAgICAgICAyMTQsXG4gICAgICAgIDExMSxcbiAgICAgICAgMTA2LFxuICAgICAgICAyNixcbiAgICAgICAgMTk0LFxuICAgICAgICAxMzQsXG4gICAgICAgIDExMyxcbiAgICAgICAgMjUyLFxuICAgICAgICA2NCxcbiAgICAgICAgMTA1LFxuICAgICAgICA0MixcbiAgICAgICAgNjEsXG4gICAgICAgIDEzLFxuICAgICAgICAxMDBcbiAgICAgIF1cbiAgICB9LFxuICAgIFwicHVibGljXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcIkJ1ZmZlclwiLFxuICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgMTM2LFxuICAgICAgICA1NixcbiAgICAgICAgMTYxLFxuICAgICAgICAxMTcsXG4gICAgICAgIDE5OCxcbiAgICAgICAgNjEsXG4gICAgICAgIDEzNixcbiAgICAgICAgMTM1LFxuICAgICAgICA4MixcbiAgICAgICAgMTEzLFxuICAgICAgICA5MSxcbiAgICAgICAgMTE1LFxuICAgICAgICA1NyxcbiAgICAgICAgMTg1LFxuICAgICAgICAxNzcsXG4gICAgICAgIDE2NCxcbiAgICAgICAgMjI3LFxuICAgICAgICAzMSxcbiAgICAgICAgMTI5LFxuICAgICAgICAxMjYsXG4gICAgICAgIDkzLFxuICAgICAgICAyMzIsXG4gICAgICAgIDE4NixcbiAgICAgICAgMTA2LFxuICAgICAgICAxNjcsXG4gICAgICAgIDE4NSxcbiAgICAgICAgMTEwLFxuICAgICAgICAxMTYsXG4gICAgICAgIDEzNyxcbiAgICAgICAgMixcbiAgICAgICAgMTQzLFxuICAgICAgICAyMVxuICAgICAgXVxuICAgIH1cbiAgfSxcbiAgXCJzaWduZWRJZGVudGl0eUtleVwiOiB7XG4gICAgXCJwcml2YXRlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcIkJ1ZmZlclwiLFxuICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgMjMyLFxuICAgICAgICAxNTcsXG4gICAgICAgIDE2NCxcbiAgICAgICAgNzMsXG4gICAgICAgIDMwLFxuICAgICAgICA3NyxcbiAgICAgICAgMjUyLFxuICAgICAgICAxMDgsXG4gICAgICAgIDIzNyxcbiAgICAgICAgMTAxLFxuICAgICAgICA5NyxcbiAgICAgICAgMjUsXG4gICAgICAgIDk5LFxuICAgICAgICAyNTEsXG4gICAgICAgIDEzNCxcbiAgICAgICAgMTI1LFxuICAgICAgICAxNzksXG4gICAgICAgIDIwMyxcbiAgICAgICAgMjQwLFxuICAgICAgICAxMDIsXG4gICAgICAgIDE5MCxcbiAgICAgICAgOTUsXG4gICAgICAgIDE3MyxcbiAgICAgICAgMTg5LFxuICAgICAgICAxMyxcbiAgICAgICAgOTIsXG4gICAgICAgIDEwMixcbiAgICAgICAgMTA3LFxuICAgICAgICA3MixcbiAgICAgICAgMTcyLFxuICAgICAgICA2NyxcbiAgICAgICAgMTExXG4gICAgICBdXG4gICAgfSxcbiAgICBcInB1YmxpY1wiOiB7XG4gICAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICAgIFwiZGF0YVwiOiBbXG4gICAgICAgIDEwNCxcbiAgICAgICAgMjA5LFxuICAgICAgICAyMzYsXG4gICAgICAgIDIxNCxcbiAgICAgICAgMTI3LFxuICAgICAgICAxNzcsXG4gICAgICAgIDI1MyxcbiAgICAgICAgMTgxLFxuICAgICAgICA4OCxcbiAgICAgICAgOTAsXG4gICAgICAgIDk2LFxuICAgICAgICAyLFxuICAgICAgICAyMjMsXG4gICAgICAgIDE2LFxuICAgICAgICAyMDUsXG4gICAgICAgIDE1MSxcbiAgICAgICAgMTU1LFxuICAgICAgICA4NSxcbiAgICAgICAgMTEyLFxuICAgICAgICAyMzksXG4gICAgICAgIDIzOCxcbiAgICAgICAgMTg2LFxuICAgICAgICAyNTIsXG4gICAgICAgIDI4LFxuICAgICAgICAyNDEsXG4gICAgICAgIDE4NyxcbiAgICAgICAgNTMsXG4gICAgICAgIDEzMixcbiAgICAgICAgMTQ2LFxuICAgICAgICAxNDEsXG4gICAgICAgIDI3LFxuICAgICAgICA2N1xuICAgICAgXVxuICAgIH1cbiAgfSxcbiAgXCJzaWduZWRQcmVLZXlcIjoge1xuICAgIFwia2V5UGFpclwiOiB7XG4gICAgICBcInByaXZhdGVcIjoge1xuICAgICAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgICAwLFxuICAgICAgICAgIDIyMCxcbiAgICAgICAgICA0MyxcbiAgICAgICAgICAyNSxcbiAgICAgICAgICAyMzgsXG4gICAgICAgICAgMTkwLFxuICAgICAgICAgIDMyLFxuICAgICAgICAgIDE4MCxcbiAgICAgICAgICA4MSxcbiAgICAgICAgICA3OSxcbiAgICAgICAgICAyMzIsXG4gICAgICAgICAgMjUwLFxuICAgICAgICAgIDE1MSxcbiAgICAgICAgICA4NyxcbiAgICAgICAgICAyMSxcbiAgICAgICAgICAxMixcbiAgICAgICAgICAxNTEsXG4gICAgICAgICAgMjAwLFxuICAgICAgICAgIDE2LFxuICAgICAgICAgIDEwNSxcbiAgICAgICAgICAyNDIsXG4gICAgICAgICAgMTAsXG4gICAgICAgICAgMTcyLFxuICAgICAgICAgIDYwLFxuICAgICAgICAgIDE2MixcbiAgICAgICAgICA1MyxcbiAgICAgICAgICAxNCxcbiAgICAgICAgICAxLFxuICAgICAgICAgIDU5LFxuICAgICAgICAgIDE0MCxcbiAgICAgICAgICA1MCxcbiAgICAgICAgICA2OVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgXCJwdWJsaWNcIjoge1xuICAgICAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgICAxNjMsXG4gICAgICAgICAgMTgzLFxuICAgICAgICAgIDcsXG4gICAgICAgICAgOTksXG4gICAgICAgICAgMjI0LFxuICAgICAgICAgIDUxLFxuICAgICAgICAgIDIzMyxcbiAgICAgICAgICAxOTMsXG4gICAgICAgICAgMTg4LFxuICAgICAgICAgIDgyLFxuICAgICAgICAgIDkwLFxuICAgICAgICAgIDI0MSxcbiAgICAgICAgICAxOTAsXG4gICAgICAgICAgMjE3LFxuICAgICAgICAgIDEwOCxcbiAgICAgICAgICAxMDksXG4gICAgICAgICAgMjYsXG4gICAgICAgICAgMjI4LFxuICAgICAgICAgIDEyNCxcbiAgICAgICAgICAyNTQsXG4gICAgICAgICAgMzgsXG4gICAgICAgICAgMjI3LFxuICAgICAgICAgIDEwOSxcbiAgICAgICAgICAxOTcsXG4gICAgICAgICAgMTcwLFxuICAgICAgICAgIDE2NyxcbiAgICAgICAgICAxODAsXG4gICAgICAgICAgMTI4LFxuICAgICAgICAgIDIyNCxcbiAgICAgICAgICAxNzgsXG4gICAgICAgICAgNDYsXG4gICAgICAgICAgMTI0XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9LFxuICAgIFwic2lnbmF0dXJlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcIkJ1ZmZlclwiLFxuICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgOTksXG4gICAgICAgIDEwNixcbiAgICAgICAgMTczLFxuICAgICAgICAyMzksXG4gICAgICAgIDY4LFxuICAgICAgICAxMzYsXG4gICAgICAgIDEyMyxcbiAgICAgICAgOTksXG4gICAgICAgIDEyOCxcbiAgICAgICAgMTM1LFxuICAgICAgICA5MyxcbiAgICAgICAgMTY1LFxuICAgICAgICAxNTUsXG4gICAgICAgIDI0LFxuICAgICAgICAxMDgsXG4gICAgICAgIDE1MSxcbiAgICAgICAgMjM5LFxuICAgICAgICA1NSxcbiAgICAgICAgMTU5LFxuICAgICAgICA2OCxcbiAgICAgICAgMjExLFxuICAgICAgICA0MSxcbiAgICAgICAgMzQsXG4gICAgICAgIDEzLFxuICAgICAgICAzOSxcbiAgICAgICAgMTc0LFxuICAgICAgICA1NCxcbiAgICAgICAgNDgsXG4gICAgICAgIDI1LFxuICAgICAgICAyNDAsXG4gICAgICAgIDEyNyxcbiAgICAgICAgMTE4LFxuICAgICAgICA2NyxcbiAgICAgICAgMTcsXG4gICAgICAgIDIzMSxcbiAgICAgICAgMzIsXG4gICAgICAgIDI0MSxcbiAgICAgICAgMTE4LFxuICAgICAgICAxMjksXG4gICAgICAgIDYyLFxuICAgICAgICAxNjYsXG4gICAgICAgIDY2LFxuICAgICAgICAxNjcsXG4gICAgICAgIDk4LFxuICAgICAgICAyNDYsXG4gICAgICAgIDE5OCxcbiAgICAgICAgMjAyLFxuICAgICAgICA0OCxcbiAgICAgICAgMTAsXG4gICAgICAgIDE0NCxcbiAgICAgICAgMixcbiAgICAgICAgMTE3LFxuICAgICAgICAxMDksXG4gICAgICAgIDE5MSxcbiAgICAgICAgMTM2LFxuICAgICAgICA1NyxcbiAgICAgICAgMjA0LFxuICAgICAgICAyMDgsXG4gICAgICAgIDIyOCxcbiAgICAgICAgMTY2LFxuICAgICAgICAxMzAsXG4gICAgICAgIDIzMSxcbiAgICAgICAgMTAsXG4gICAgICAgIDE0MlxuICAgICAgXVxuICAgIH0sXG4gICAgXCJrZXlJZFwiOiAxXG4gIH0sXG4gIFwicmVnaXN0cmF0aW9uSWRcIjogNTMsXG4gIFwiYWR2U2VjcmV0S2V5XCI6IFwibFVDSWI1TnpDdFBTNlY0Y1JJTjU0dEF6UlJvZjRqbjRucnRYWmhsNzBXST1cIixcbiAgXCJwcm9jZXNzZWRIaXN0b3J5TWVzc2FnZXNcIjogW10sXG4gIFwibmV4dFByZUtleUlkXCI6IDMxLFxuICBcImZpcnN0VW51cGxvYWRlZFByZUtleUlkXCI6IDMxLFxuICBcImFjY291bnRTeW5jQ291bnRlclwiOiAwLFxuICBcImFjY291bnRTZXR0aW5nc1wiOiB7XG4gICAgXCJ1bmFyY2hpdmVDaGF0c1wiOiBmYWxzZVxuICB9LFxuICBcImRldmljZUlkXCI6IFwiWFFzcXZ6cmtSeWVFVHMtNVc1UDlaUVwiLFxuICBcInBob25lSWRcIjogXCI0ZmZjNTFlYS05ZDNkLTQzYzAtYjQ0ZS00YjRkNDBkODQyMTlcIixcbiAgXCJpZGVudGl0eUlkXCI6IHtcbiAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICBcImRhdGFcIjogW1xuICAgICAgMjcsXG4gICAgICAyMzYsXG4gICAgICA0MSxcbiAgICAgIDE0NSxcbiAgICAgIDM1LFxuICAgICAgMTcwLFxuICAgICAgMzEsXG4gICAgICAxOTksXG4gICAgICA5OSxcbiAgICAgIDE1MyxcbiAgICAgIDE4NCxcbiAgICAgIDE4MixcbiAgICAgIDIxLFxuICAgICAgMTkzLFxuICAgICAgMTA4LFxuICAgICAgMTEyLFxuICAgICAgMzksXG4gICAgICAxNjIsXG4gICAgICAxMDksXG4gICAgICAyMDNcbiAgICBdXG4gIH0sXG4gIFwicmVnaXN0ZXJlZFwiOiB0cnVlLFxuICBcImJhY2t1cFRva2VuXCI6IHtcbiAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICBcImRhdGFcIjogW1xuICAgICAgNTEsXG4gICAgICAxOTksXG4gICAgICAxOTgsXG4gICAgICA3OSxcbiAgICAgIDE4NixcbiAgICAgIDEwMixcbiAgICAgIDE0NCxcbiAgICAgIDIzMyxcbiAgICAgIDYsXG4gICAgICAxNTQsXG4gICAgICAxODYsXG4gICAgICAxNDQsXG4gICAgICAxNjYsXG4gICAgICAyMzQsXG4gICAgICA4NixcbiAgICAgIDE3OCxcbiAgICAgIDE3OCxcbiAgICAgIDE0MCxcbiAgICAgIDIzOCxcbiAgICAgIDE1NVxuICAgIF1cbiAgfSxcbiAgXCJyZWdpc3RyYXRpb25cIjoge30sXG4gIFwicGFpcmluZ0NvZGVcIjogXCI0MlE2RkE0R1wiLFxuICBcIm1lXCI6IHtcbiAgICBcImlkXCI6IFwiOTIzNDU4NDAxMjk4OjJAcy53aGF0c2FwcC5uZXRcIixcbiAgICBcImxpZFwiOiBcIjE4MTU3MDE2MTkxODA0NDoyQGxpZFwiXG4gIH0sXG4gIFwiYWNjb3VudFwiOiB7XG4gICAgXCJkZXRhaWxzXCI6IFwiQ1BiWjVab0NFUGZDNjdjR0dBRWdBQ2dBXCIsXG4gICAgXCJhY2NvdW50U2lnbmF0dXJlS2V5XCI6IFwid3p0czIvNVh3S1V4aVdOZ2I1N2NhNmhVWUJBRUNSS3RMb2pYelNLU1JBMD1cIixcbiAgICBcImFjY291bnRTaWduYXR1cmVcIjogXCJRQkNCU25BS3hpMGdtWmxpVmpjWTdNdDh4Mk45VklEMWErV096V2tVYmJSS05XL203NDlweWdQMFJ3bnNITGU4YW5QRHVRb0pVS0Vvc1BrUXFnNWdBdz09XCIsXG4gICAgXCJkZXZpY2VTaWduYXR1cmVcIjogXCJZRmVDalc4OG5oRU5qb3N0Y1YvOHozeTFxdkNaZnlSWDVYc29LbjJkdXYzNStZOHhkZWFURFFucENKZEJKM0M5YklCY1RUbVVId3JXV0h3Z2UySmppdz09XCJcbiAgfSxcbiAgXCJzaWduYWxJZGVudGl0aWVzXCI6IFtcbiAgICB7XG4gICAgICBcImlkZW50aWZpZXJcIjoge1xuICAgICAgICBcIm5hbWVcIjogXCI5MjM0NTg0MDEyOTg6MkBzLndoYXRzYXBwLm5ldFwiLFxuICAgICAgICBcImRldmljZUlkXCI6IDBcbiAgICAgIH0sXG4gICAgICBcImlkZW50aWZpZXJLZXlcIjoge1xuICAgICAgICBcInR5cGVcIjogXCJCdWZmZXJcIixcbiAgICAgICAgXCJkYXRhXCI6IFtcbiAgICAgICAgICA1LFxuICAgICAgICAgIDE5NSxcbiAgICAgICAgICA1OSxcbiAgICAgICAgICAxMDgsXG4gICAgICAgICAgMjE5LFxuICAgICAgICAgIDI1NCxcbiAgICAgICAgICA4NyxcbiAgICAgICAgICAxOTIsXG4gICAgICAgICAgMTY1LFxuICAgICAgICAgIDQ5LFxuICAgICAgICAgIDEzNyxcbiAgICAgICAgICA5OSxcbiAgICAgICAgICA5NixcbiAgICAgICAgICAxMTEsXG4gICAgICAgICAgMTU4LFxuICAgICAgICAgIDIyMCxcbiAgICAgICAgICAxMDcsXG4gICAgICAgICAgMTY4LFxuICAgICAgICAgIDg0LFxuICAgICAgICAgIDk2LFxuICAgICAgICAgIDE2LFxuICAgICAgICAgIDQsXG4gICAgICAgICAgOSxcbiAgICAgICAgICAxOCxcbiAgICAgICAgICAxNzMsXG4gICAgICAgICAgNDYsXG4gICAgICAgICAgMTM2LFxuICAgICAgICAgIDIxNSxcbiAgICAgICAgICAyMDUsXG4gICAgICAgICAgMzQsXG4gICAgICAgICAgMTQ2LFxuICAgICAgICAgIDY4LFxuICAgICAgICAgIDEzXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIF0sXG4gIFwicGxhdGZvcm1cIjogXCJhbmRyb2lkXCIsXG4gIFwibGFzdEFjY291bnRTeW5jVGltZXN0YW1wXCI6IDE3Mjc3MTc3NTUsXG4gIFwibXlBcHBTdGF0ZUtleUlkXCI6IFwiQUFBQUFEcWxcIlxufSIsCiAgImFwcC1zdGF0ZS1zeW5jLWtleS1BQUFBQURxbC5qc29uIjogIntcImtleURhdGFcIjpcIm5NSkNFYW90SnJnQ3RUMTVsbFJIYlpaUkZ3MStDWVNLbEdRSWN2NG43NFU9XCIsXCJmaW5nZXJwcmludFwiOntcInJhd0lkXCI6NTkzMDYzMTU3LFwiY3VycmVudEluZGV4XCI6MSxcImRldmljZUluZGV4ZXNcIjpbMF19LFwidGltZXN0YW1wXCI6XCIxNzI3NzEyNzI1ODk0XCJ9Igp9' // Edit this line only, don't remove ' <- this symbol

if (!existsSync('Itxxwasi')) {
  console.log('Cloning the repository...')
  const cloneResult = spawnSync(
    'git',
    ['clone', 'https://github.com/Itxxwasi/WASI-MD-V.git', 'Itxxwasi'],
    {
      stdio: 'inherit',
    }
  )

  if (cloneResult.error) {
    throw new Error(`Failed to clone the repository: ${cloneResult.error.message}`)
  }

  const configPath = 'Itxxwasi/config.env'
  try {
    console.log('Writing to config.env...')
    writeFileSync(configPath, `VPS=true\nSESSION_ID=${SESSION_ID}`)
  } catch (err) {
    throw new Error(`Failed to write to config.env: ${err.message}`)
  }

  console.log('Installing dependencies...')
  const installResult = spawnSync('yarn', ['install', '--network-concurrency', '3'], {
    cwd: 'Itxxwasi',
    stdio: 'inherit',
  })

  if (installResult.error) {
    throw new Error(`Failed to install dependencies: ${installResult.error.message}`)
  }
}

spawnSync('yarn', ['start'], { cwd: 'Itxxwasi', stdio: 'inherit' })
